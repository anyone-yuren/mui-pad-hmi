import{R as f,r as S,j as y}from"./index-37af907f.js";import"./popupAction.styled-7c616d08.js";import{K as h,S as L}from"./ReactKonvaCore-a5150e1f.js";import C from"./lineGrid-a680e350.js";import b from"./points-03276591.js";import{u as k}from"./index-fa453ff5.js";import{u as A}from"./map-b36eff15.js";import"./tslib.es6-9d30b114.js";import"./ResizeObserver.es-0f9f8adb.js";let g=null,p=0;const Q=V=>{const[K,P]=f.useState(1),[X,W]=f.useState({x:0,y:0}),{agvPosition:d,lockAgvView:u}=A(t=>({agvPosition:t.agvPosition,lockAgvView:t.lockAgvView})),o=f.useRef(null),w=f.useRef(null),[v,D]=f.useState({width:2400,height:2400,offsetY:0,offsetX:0}),n=k(o);S.useEffect(()=>{n&&n.width&&n.height&&D({...v,offsetY:-(((n==null?void 0:n.width)||2)/2),offsetX:((n==null?void 0:n.height)||2)/2})},[n]),S.useEffect(()=>{const t=w.current,e=new h.Tween({node:t,duration:5,x:-d.y,y:d.x,easing:h.Easings.Linear});if(!u){new h.Tween({node:t,duration:5,x:t.x(),y:t.y(),easing:h.Easings.Linear}).finish();return}e.play()},[d,u]);const R=t=>{t.evt.preventDefault(),console.log("奇葩的滚轮事件开始出发",u);const e=1.1,s=t.target.getStage(),i=s.scaleX(),l=s.getPointerPosition(),c={x:(l.x-s.x())/i,y:(l.y-s.y())/i};let r=t.evt.deltaY>0?i/e:i*e;P(r),s.scale({x:r,y:r});const x={x:l.x-c.x*r,y:l.y-c.y*r};s.position(x),s.batchDraw()},M=t=>{t.evt.preventDefault();const e=t.evt.touches[0],s=t.evt.touches[1];if(!u&&e&&s){console.log("[stationStage.tsx] 地图TouchMove双指事件 触发"),o.current.isDragging()&&o.current.stopDrag();const i={x:e.clientX,y:e.clientY},l={x:s.clientX,y:s.clientY};if(!g){g=m(i,l);return}const c=m(i,l),r=T(i,l);p||(p=r);const x={x:(c.x-o.current.x())/o.current.scaleX(),y:(c.y-o.current.y())/o.current.scaleX()};let a=o.current.scaleX()*(r/p);console.log("scale",a),a>2&&(a=2),a<.5&&(a=.5),o.current.scaleX(a),o.current.scaleY(a);const j=c.x-g.x,E=c.y-g.y,Y={x:c.x-x.x*a+j,y:c.y-x.y*a+E};o.current.position(Y),p=r,g=c}},T=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),m=(t,e)=>({x:(t.x+e.x)/2,y:(t.y+e.y)/2});return y.jsx("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",overflow:"hidden"},ref:o,children:y.jsxs(L,{...v,...X,draggable:!u,ref:w,rotationDeg:-90,onWheel:R,onTouchMove:M,children:[y.jsx(C,{}),y.jsx(b,{})]})})};export{Q as default};
